Sys*fw

# Flush any existing rules
nft flush ruleset

# Create the table and chains
nft add table inet filter
nft add chain inet filter input { type filter hook input priority 0 \; policy drop \; }
nft add chain inet filter forward { type filter hook forward priority 0 \; policy drop \; }
nft add chain inet filter output { type filter hook output priority 0 \; policy accept \; }

# Allow local traffic
nft add rule inet filter input iif lo accept
nft add rule inet filter output oif lo accept

# Allow established/related traffic
nft add rule inet filter forward state established,related accept

# Allow specific AppVM outbound traffic (e.g., 443 for HTTPS)
nft add rule inet filter forward iif "vif*" oif eth0 tcp dport { 80, 443 } accept

# Allow ICMP
nft add rule inet filter input ip protocol icmp accept
nft add rule inet filter output ip protocol icmp accept

# Drop all other forward traffic
nft add rule inet filter forward drop

# Save the configuration
nft list ruleset > /etc/nftables.conf
