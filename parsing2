Sub SortAndColorDates()
    Dim wsName As String
    Dim ws As Worksheet
    Dim tbl As ListObject
    Dim rng As Range
    Dim cell As Range
    Dim todayDate As Date
    Dim oneMonthDate As Date
    Dim twoMonthDate As Date
    Dim tableFound As Boolean
    Dim allSheets As String
    Dim sheet As Worksheet
    
    ' List all worksheets
    allSheets = ""
    For Each sheet In ThisWorkbook.Sheets
        allSheets = allSheets & sheet.Name & vbCrLf
    Next sheet
    MsgBox "Available worksheets are:" & vbCrLf & allSheets
    
    ' Prompt the user for the worksheet name
    wsName = InputBox("Please enter the name of the worksheet:", "Worksheet Name")
    
    ' Check if the user entered a name
    If wsName = "" Then
        MsgBox "No worksheet name entered.", vbExclamation
        Exit Sub
    End If
    
    ' Define the worksheet
    On Error Resume Next
    Set ws = ThisWorkbook.Sheets(wsName)
    On Error GoTo 0
    
    ' Check if the worksheet exists
    If ws Is Nothing Then
        MsgBox "The worksheet '" & wsName & "' does not exist.", vbExclamation
        Exit Sub
    End If
    
    ' Confirm worksheet found
    MsgBox "Worksheet '" & wsName & "' found."

    ' Search for the table on the worksheet
    tableFound = False
    For Each tbl In ws.ListObjects
        tableFound = True
        Exit For
    Next tbl
    
    ' Check if a table was found
    If Not tableFound Then
        MsgBox "No table found on the worksheet '" & wsName & "'.", vbExclamation
        Exit Sub
    End If
    
    ' Confirm table found
    MsgBox "Table found on the worksheet '" & wsName & "'."

    ' Sort the table by Column C (Date)
    With tbl.Sort
        .SortFields.Clear
        .SortFields.Add Key:=tbl.ListColumns("C").Range, SortOn:=xlSortOnValues, Order:=xlAscending, DataOption:=xlSortNormal
        .Header = xlYes
        .MatchCase = False
        .Orientation = xlTopToBottom
        .SortMethod = xlPinYin
        .Apply
    End With

    ' Define date variables
    todayDate = Date
    oneMonthDate = DateAdd("m", 1, todayDate)
    twoMonthDate = DateAdd("m", 2, todayDate)

    ' Define the range of dates in the table
    Set rng = tbl.ListColumns("C").DataBodyRange

    ' Loop through each cell in the range
    For Each cell In rng
        If IsDate(cell.Value) Then
            Select Case cell.Value
                Case Is <= todayDate
                    cell.Interior.Color = RGB(255, 0, 0) ' Red
                Case Is <= oneMonthDate
                    cell.Interior.Color = RGB(255, 255, 0) ' Yellow
                Case Is <= twoMonthDate
                    cell.Interior.Color = RGB(255, 165, 0) ' Orange
                Case Else
                    cell.Interior.Color = RGB(0, 255, 0) ' Green
            End Select
        End If
    Next cell
    
    ' Confirm completion
    MsgBox "Sorting and coloring completed."
End Sub
